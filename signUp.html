<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Create account</title>
    <meta name="description" content="LM search" />
    <link rel="icon" type="image/ico" href="03_192x192.ico" sizes="192x192">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/limonte-sweetalert2/6.10.3/sweetalert2.css" />
    <style>
        @import url('https://fonts.googleapis.com/css?family=Muli&display=swap');

        * {
            box-sizing: border-box;
        }

        body {
            color: whitesmoke;
            line-height: 30px;
            /*設定字體範圍高度（行間距）*/
            font-weight: bold;
            font-family: 'Muli';
            overflow: hidden;
            background: linear-gradient(132deg, #24c6dc, #3494e6, #ec6ead, #f80759, #bc4e9c);
            background-size: 400% 400%;
            animation: Gradient 15s ease infinite;
        }

        /* Animate Background*/
        @keyframes Gradient {
            0% {
                background-position: 0% 50%
            }

            50% {
                background-position: 100% 50%
            }

            100% {
                background-position: 0% 50%
            }
        }

        .contentFrame {
            background-color: #563d7c;
            display: inline-block;
            border: 4px solid white;
            border-radius: .25rem;
            padding: 17px;
            position: absolute;
            top: 30%;
            left: 39%;
        }

        .logol {
            padding-bottom: 10px;
        }

        button {
            padding: 5px 15px;
            margin: 6px;
            float: right;
            background-color: #563d7c;
            color: whitesmoke;
            cursor: pointer;
            -webkit-border-radius: 5px;
            border-radius: 5px;
        }

        button:hover {
            background-color: whitesmoke;
            color: #563d7c;
            font-weight: bolder;
            letter-spacing: 3px;
        }

        button:focus {
            outline: none;
            background-color: #563d7c;
            color: whitesmoke;
        }

        .inputText {
            padding: 5px 15px;
            border: 2px black solid;
            -webkit-border-radius: 5px;
            border-radius: 5px;
            margin-left: 4px;
            background-color: rgb(247, 247, 247);
        }

        .inputText:hover {
            border: 2px solid #ffe484;
        }

        .inputText:focus {
            border: 4px solid #ffe484;
            outline: none;
        }
    </style>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js" type="text/javascript"></script>
</head>

<body>
    <div class="contentFrame">
        <h1 class="logol"><span style="color:crimson;">L</span><span style="color: rgb(57, 150, 243);">M</span><span
                style="color: goldenrod;"> Search</span></h1>
        <p>
            &#9831;&nbsp;&nbsp;使用者名稱&nbsp;:&nbsp;<label><input id="username" type="text" class="inputText"
                    placeholder="enter your username" autofocus /></label>
        </p>
        <p>
            &#9831;&nbsp;&nbsp;帳號&nbsp;:&nbsp;<label><input id="account" type="text" class="inputText"
                    placeholder="3 ~ 20 words" /></label>
        </p>
        <p>
            &#9831;&nbsp;&nbsp;密碼&nbsp;:&nbsp;<label><input id="passward" type="password" class="inputText"
                    placeholder="3 ~ 20 words" /></label>
        </p>
        <p>
            &#9831;&nbsp;&nbsp;驗證密碼&nbsp;:&nbsp;<label><input id="validatePW" type="password" class="inputText"
                    placeholder="enter your passward again" /></label>
        </p>
        <p>
            <button id="backBtn">回登入畫面</button>
            <button id="createBtn">創建帳號</button>
        </p>
    </div>

    <script src="https://code.jquery.com/jquery-3.2.1.min.js" type="text/javascript"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/limonte-sweetalert2/6.10.3/sweetalert2.js"
        type="text/javascript"></script>
    <script type="text/javascript">
        swal.setDefaults({
            confirmButtonText: "確定",
            cancelButtonText: "取消"
        });

        $(document).ready(function () {
            initial();
            $("#createBtn").click(function () {
                let um = $("#username").val(),
                    act = $("#account").val(),
                    pw = $("#passward").val(),
                    vd = $("#validatePW").val();
                let format = Restrict();

                if (!act) {
                    swal("OOPS!!", "請輸入帳號 \u2620", "error");
                }
                else if (!pw) {
                    swal("OOPS!!", "請輸入密碼 \u2620", "error");
                }
                else if (!vd) {
                    swal("OOPS!!", "請在驗證密碼處輸入密碼 \u2620", "error");
                }
                else if (pw != vd) {
                    swal("OOPS!!", "輸入的驗證密碼有誤 \u2620", "error");
                }
                else {
                    let cmd = {};
                    cmd["act"] = "creatAccount";
                    cmd["username"] = um;
                    cmd["account"] = act;
                    cmd["password"] = pw;
                    $.post("index.php", cmd, function (data) {
                        data = JSON.parse(data);
                        if (data.statue == false) {
                            swal("ERROR", data.errorCode, "error");
                        }
                        else {
                            swal("完成!", "創建成功\n歡迎使用LM Search \U+1F60A", "success");
                            leaveUserDetails(data.data, um);
                            window.location.href = "search.html";
                        }
                    });
                }
            });

            $("#backBtn").click(function () {
                let sure = window.confirm("OPPS!\n尚未建立，確定要離開此頁面嗎?");
                if (sure != null) {
                    window.location.href = "index.html";
                }
            });
        });

        function initial() {
            $("#username").val("");
            $("#account").val("");
            $("#passward").val("");
            $("#validatePW").val("");
        }

        function Restrict() {
            let act = $("#account").val(),
                pw = $("#passward").val();
            let re = /[^a-zA-Z0-9_]/;
            let okAccount = re.exec(act),
                okPassword = re.exec(pw);

            if (act.length > 20 || act.length < 3) {
                swal("OOPS!!", "帳號字數只能在3~20內!!!!", "error");
                $("#account").select().val();
                return false;
            }
            else if (okAccount) {
                swal("OOPS!!", "帳號只能是英文、數字、底線哦", "error");
                $("#account").select();
                return false;
            }
            else if (pw.length > 20 || pw.length < 3) {
                swal("OOPS!!", "密碼字數只能在3~20內!!!!", "error");
                $("#passward").select();
                return false;
            }
            else if (okPassword) {
                swal("OOPS!!", "密碼只能是英文、數字、底線哦", "error");
                $("#passward").select();
                return false;
            }
            return true;
        }

        function leaveUserDetails(id, namem) {
            sessionStorage.setItem("LM-UserId", id);
            sessionStorage.setItem("LM-UserName", namem);
            sessionStorage.setItem("LM-showSeat", "5");
            sessionStorage.setItem("LM-over", "0");
            sessionStorage.setItem("LM-alarm", "0");
        }

    </script>
</body>

</html>